#**********************************************************************#
#                                                                      #
#                        FoCaLize compiler                             #
#                                                                      #
#            François Pessaux                                          #
#            Pierre Weis                                               #
#            Damien Doligez                                            #
#                                                                      #
#                               LIP6  --  INRIA Rocquencourt           #
#                                                                      #
#  Copyright 2008 LIP6 and INRIA                                       #
#  Distributed only by permission.                                     #
#                                                                      #
#**********************************************************************#

# $Id: Makefile.config,v 1.18 2008-12-18 11:25:46 weis Exp $

# Reading software configuration variables.
include $(ROOT_DIR)/.config_var

# Basic Unix commands
CD = cd
CP = cp -f
CHMODGR = chmod g+r
CHMODGRW = chmod g+rw
CHMODR = chmod +r
CHMODRX = chmod +rx
CHMODX = chmod +x
LN = ln -sf
MAKE = make
MKDIR = mkdir -p
MV = mv -f
RM = rm -rf
TARC = tar cvzf
TARX = tar xvzf
TOUCH = touch

#
## MANAGING EXTERNAL TOOLS ##
#

# Focalize distribution includes the external tools that are MANDATORY for
# focalize to work properly.
# We must provide almost all their transitive closure :(
# The first step of the installation process is to untar, compile and install
# all those tools.

# Where the installation will take place:

# The directory where the tar balls are stored.
TAR_BALLS_DIR_NAME = tarballs
TAR_BALLS_DIR = $(ROOT_DIR)/$(TAR_BALLS_DIR_NAME)
ABSOLUTE_TAR_BALLS_DIR = $(ABSOLUTE_ROOT_DIR)/$(TAR_BALLS_DIR_NAME)

# For each tool, we define its sub-directory, its tar ball file name,
# its configuration options, and make all target.

# The Caml compiler
CAML_DIR_NAME = ocaml-3.10.2
CAML_DIR = $(ROOT_DIR)/$(CAML_DIR_NAME)
ABSOLUTE_CAML_DIR = $(ABSOLUTE_ROOT_DIR)/$(CAML_DIR_NAME)

CAML_TAR_BALL = $(CAML_DIR_NAME).tar.gz
CAML_TAR_BALLS = $(CAML_TAR_BALL)
CAML_CONFIGURE_OPTIONS = -prefix $(SHARE_PROJECT_DIR)
CAML_MAKE_ALL_TARGET = world.opt

# Caml executable files
CAML_BYT_NAME = ocamlc
CAML_BIN_NAME = ocamlopt
CAML_DEP_NAME = ocamldep
CAML_DOC_NAME = ocamldoc
CAML_LEX_NAME = ocamllex
CAML_YAC_NAME = ocamlyacc

CAML_BYT = $(ABSOLUTE_CAML_DIR)/$(CAML_BYT_NAME)
CAML_BIN = $(ABSOLUTE_CAML_DIR)/$(CAML_BIN_NAME)
CAML_DEP = $(ABSOLUTE_CAML_DIR)/$(CAML_DEP_NAME)
CAML_DOC = $(ABSOLUTE_CAML_DIR)/$(CAML_DOC_NAME)
CAML_LEX = $(ABSOLUTE_CAML_DIR)/$(CAML_LEX_NAME)
CAML_YAC = $(ABSOLUTE_CAML_DIR)/$(CAML_YAC_NAME)

CAML_BYT_EXE = $(CAML_BYT)
CAML_BIN_EXE = $(CAML_BIN)
CAML_DEP_EXE = $(CAML_DEP)
CAML_DOC_EXE = $(CAML_DOC)
CAML_LEX_EXE = $(CAML_LEX)
CAML_YAC_EXE = $(CAML_YAC)

CAML_EXES = \
 $(CAML_BYT)\
 $(CAML_BIN)\
 $(CAML_DEP)\
 $(CAML_DOC)\
 $(CAML_LEX)\
 $(CAML_YAC)

# The CamlP5 pre-processor
CAMLP5_DIR_NAME = camlp5-5.09
CAMLP5_DIR = $(ROOT_DIR)/$(CAMLP5_DIR_NAME)
ABSOLUTE_CAMLP5_DIR = $(ABSOLUTE_ROOT_DIR)/$(CAMLP5_DIR_NAME)

CAMLP5_TAR_BALL = $(CAMLP5_DIR_NAME).tgz
CAMLP5_PATCH_TAR_BALL = $(CAMLP5_DIR_NAME)_patch.tgz
CAMLP5_TAR_BALLS = $(CAMLP5_TAR_BALL) $(CAMLP5_PATCH_TAR_BALL)
CAMLP5_CONFIGURE_OPTIONS = -transitional -prefix $(SHARE_PROJECT_DIR)
CAMLP5_MAKE_ALL_TARGET = world.opt

# CamlP5 executables
CAMLP5_NAME = camlp5
CAMLP5 = $(SHARE_PROJECT_DIR)/$(CAMLP5_NAME)

CAMLP5_EXE = $(CAMLP5)

CAMLP5_EXES = \
 $(CAMLP5_EXE)

# The Coq proof assistant
COQ_DIR_NAME = coq-8.1pl4
COQ_DIR = $(ROOT_DIR)/$(COQ_DIR_NAME)
ABSOLUTE_COQ_DIR = $(ABSOLUTE_ROOT_DIR)/$(COQ_DIR_NAME)

COQ_TAR_BALL = $(COQ_DIR_NAME).tar.gz
COQ_PATCH_TAR_BALL = $(COQ_DIR_NAME)_patch.tgz
COQ_TAR_BALLS = $(COQ_TAR_BALL) $(COQ_PATCH_TAR_BALL)
COQ_CONFIGURE_OPTIONS = \
 -prefix $(SHARE_PROJECT_DIR)\
 -camldir $(SHARE_PROJECT_DIR)/bin\
 -camlp5dir $(SHARE_PROJECT_DIR)/lib/ocaml/camlp5\
 -reals all \
 -coqide no
COQ_MAKE_ALL_TARGET = world

# Coq executable files
COQC_NAME = coqc

COQC = $(ABSOLUTE_COQ_DIR)/$(COQC_NAME)

COQC_EXE = $(COQC)

COQ_EXES =\
 $(COQC)

# Convenient abbrevs for all external tools stuff.
EXTERNAL_TOOLS_TAR_BALLS = $(CAML_TAR_BALL) $(CAMLP5_TAR_BALL) $(COQ_TAR_BALL)
EXTERNAL_TOOLS_DIRS = $(CAML_DIR) $(CAMLP5_DIR) $(COQ_DIR)
EXTERNAL_TOOLS_EXES = $(CAML_EXES) $(CAMLP5_EXES) $(COQ_EXES)

#
## MANAGING INTERNAL TOOLS ##
#

# Internal tools are zenon (the automatic proof generator), zvtov (the
# translator from zenon proofs to coq proof lambda-terms), and focalizec (the
# compiler for focalize programs).
# All these tools are compiled in turn after configuration.

# Zenon
ZENON_DIR_NAME = zenon
ZENON_EXE_NAME = zenon
ZENON_DIR = $(ROOT_DIR)/$(ZENON_DIR_NAME)
ABSOLUTE_ZENON_DIR =
ZENON_EXE = $(ABSOLUTE_ZENON_DIR)/$(ZENON_EXE_NAME)
ZENONC = $(ZENON_EXE)

ZENON_EXES = $(ZENONC)

# Zvtov
ZVTOV_DIR_NAME = zvtov
ZVTOV_EXE_NAME = zvtov
ZVTOV_DIR = $(ROOT_DIR)/$(ZVTOV_DIR_NAME)
ABSOLUTE_ZVTOV_DIR = $(ABSOLUTE_ROOT_DIR)/$(ZVTOV_DIR_NAME)
ZVTOV_EXE = $(ABSOLUTE_ZVTOV_DIR)/$(ZVTOV_EXE_NAME)
ZVTOVC = $(ZVTOV_EXE)

ZVTOV_EXES = $(ZVTOVC)

# Focalizec
FOCALIZEC_DIR_NAME = focalizec
FOCALIZEC_EXE_NAME = focalizec
FOCALIZEC_DIR = $(ROOT_DIR)/$(FOCALIZEC_DIR_NAME)
ABSOLUTE_FOCALIZEC_DIR = $(ABSOLUTE_ROOT_DIR)/$(FOCALIZEC_DIR_NAME)
FOCALIZEC_EXE = $(ABSOLUTE_FOCALIZEC_DIR)/$(FOCALIZEC_EXE_NAME)
FOCALIZEC = $(FOCALIZEC_EXE)

FOCALIZEC_EXES = $(FOCALIZEC)

INTERNAL_TOOLS_DIRS = $(ZENON_DIR) $(ZVTOV_DIR) $(FOCALIZEC_DIR)
INTERNAL_TOOLS_EXES = $(ZENON_EXES) $(ZVTOV_EXES) $(FOCALIZEC_EXES)
