#!/bin/sh

#**********************************************************************#
#                                                                      #
#                        FoCaLiZe compiler                             #
#                                                                      #
#            François Pessaux                                          #
#            Pierre Weis                                               #
#            Damien Doligez                                            #
#                                                                      #
#                               LIP6  --  INRIA Rocquencourt           #
#                                                                      #
#  Copyright 2008 INRIA                                                #
#  Distributed only by permission.                                     #
#                                                                      #
#**********************************************************************#

# $Id: configure,v 1.91 2012-10-15 14:23:06 pessaux Exp $

BOLDTAG="\033[1m"
UNDERLINETAG="\033[4m"
NORMALTAG="\033[0m"

# #############################################################################
# Pre-requisite tools stuff.

CAMLWITNESS=`which ocamlc`
CAMLDIR=`dirname $CAMLWITNESS`
if [ "$CAMLDIR" != "" ] ;
    then
    echo $BOLDTAG"OCaml installation found in $CAMLDIR."$NORMALTAG
    echo "Press enter to use default or specify another path."
    read USER_INPUT
    if [ "$USER_INPUT" != "" ] ;
       then
       CAMLDIR=$USER_INPUT
    fi
    else
    echo $BOLDTAG"OCaml installation not found."$NORMALTAG
    echo "Specify the path where to find OCaml commands."
    read USER_INPUT
    CAMLDIR=$USER_INPUT
fi
if [ "$CAMLDIR" = "" ] ;
    then
    echo "Error. OCaml not available. Install it first."
    exit 1
    fi

CAMLBYT=$CAMLDIR/ocamlc
CAMLBIN=$CAMLDIR/ocamlopt
CAMLLEX=$CAMLDIR/ocamllex
CAMLYACC=$CAMLDIR/ocamlyacc
CAMLDOC=$CAMLDIR/ocamldoc
CAMLDEP=$CAMLDIR/ocamldep

COQWITNESS=`which coqc`
COQDIR=`dirname $COQWITNESS`
if [ "$COQDIR" != "" ] ;
then
    echo $BOLDTAG"Coq installation found in $COQDIR."$NORMALTAG
    echo "Press enter to use default or specify another location."
    read USER_INPUT
    if [ "$USER_INPUT" != "" ] ;
       then
       COQDIR=$USER_INPUT
    fi
else
    echo $BOLDTAG"Coq installation not found."$NORMALTAG
    echo "Specify the path where to find Coq commands."
    read USER_INPUT
    COQDIR=$USER_INPUT
fi
if [ "$COQDIR" = "" ] ;
then
    echo "Error. Coq not available. Install it first."
    exit 1
    fi

COQC=$COQDIR/coqc
COQDEP=$COQDIR/coqdep

# #############################################################################
# Generate the installation and configuration file containing tools vars.
CONFIGURATION_VARS_FILE=.config_var

rm -f $CONFIGURATION_VARS_FILE
echo "CAMLBYT=$CAMLBYT" > $CONFIGURATION_VARS_FILE
echo "CAMLBIN=$CAMLBIN" >> $CONFIGURATION_VARS_FILE
echo "CAMLLEX=$CAMLLEX" >> $CONFIGURATION_VARS_FILE
echo "CAMLYACC=$CAMLYACC" >> $CONFIGURATION_VARS_FILE
echo "CAMLDOC=$CAMLDOC" >> $CONFIGURATION_VARS_FILE
echo "CAMLDEP=$CAMLDEP" >> $CONFIGURATION_VARS_FILE
echo "COQC=$COQC" >> $CONFIGURATION_VARS_FILE
echo "COQDEP=$COQDEP" >> $CONFIGURATION_VARS_FILE
echo "WARN_ERROR=a" >> $CONFIGURATION_VARS_FILE
chmod a-w $CONFIGURATION_VARS_FILE

# #############################################################################
# Summary feedback.
echo "Configuration summary for focalize:"
echo "  ocamlc = $CAMLBYT"
echo "  ocamlopt = $CAMLBIN"
echo "  ocamllex = $CAMLLEX"
echo "  ocamlyacc = $CAMLYACC"
echo "  ocamldoc = $CAMLDOC"
echo "  ocamldep = $CAMLDEP"
echo "  coqc = $COQC"
echo "  coqdep = $COQDEP"
echo "Done"
