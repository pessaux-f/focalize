#!/bin/sh

BOLDTAG="\033[1m"
UNDERLINETAG="\033[4m"
NORMALTAG="\033[0m"

SUB_DIRS="basement parser typing \
  docgen commoncodegen mlcodegen coqcodegen \
  toplevel \
  stdlib \
  extlib extlib/algebra extlib/access_control \
  contribs"

touch .depend
for i in $SUB_DIRS ; do
  (cd $i; touch .depend; mkdir -p odoc)
done

FOC_INSTALL_BIN=/usr/local/bin
FOC_INSTALL_LIB=/usr/local/lib/focalize

echo -e $BOLDTAG"Where to install FoCaL binaries ?"$NORMALTAG
echo -e "Default is $FOC_INSTALL_BIN."
echo -e "Just press enter to use default location."
read USER_INPUT
if [ "$USER_INPUT" != "" ] ;
   then
   FOC_INSTALL_BIN=$USER_INPUT
fi

echo -e $BOLDTAG"Where to install FoCaL libraries ?"$NORMALTAG
echo -e "Default is $FOC_INSTALL_LIB."
echo -e "Just press enter to use default location."
read USER_INPUT
if [ "$USER_INPUT" != "" ] ;
   then
   FOC_INSTALL_LIB=$USER_INPUT
fi

# Generate the installation related source file.
echo "(* This file is automatically generated by configure. Do not manually edit. *)" \
      > basement/installation.ml
echo "let install_bin_dir = \"$FOC_INSTALL_BIN\" ;;" >> basement/installation.ml
echo "let install_lib_dir = \"$FOC_INSTALL_LIB\" ;;" >> basement/installation.ml
echo "(* End of generated source file. *)" >> basement/installation.ml

# Temporarily borrow some Coq files from the installation of the old compiler.
# Must disapear one day...
rm -f stdlib/zenon.v; ln -s ../../zenon/zenon.v stdlib/zenon.v
rm -f stdlib/zenon_coqbool.v; ln -s ../../zenon/zenon_coqbool.v 

# Building dependancy files
make depend

# Summary feedback.
echo -e "Configuration done for:"
echo -e "  binaries -> $FOC_INSTALL_BIN"
echo -e "  libraries -> $FOC_INSTALL_LIB"

echo "Done. Now, please invoke: make all"
