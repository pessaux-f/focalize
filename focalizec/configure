#!/bin/sh

BOLDTAG="\033[1m"
UNDERLINETAG="\033[4m"
NORMALTAG="\033[0m"

SUB_DIRS="basement parser typing \
  docgen commoncodegen mlcodegen coqcodegen \
  toplevel \
  refman \
  stdlib \
  extlib extlib/algebra extlib/access_control \
  contribs"

touch .depend

for i in $SUB_DIRS ; do
  (cd $i; touch .depend; mkdir -p odoc)
done

INSTALL_PREFIX=/usr/local
INSTALL_BIN=${INSTALL_PREFIX}/bin
INSTALL_LIB_DIR=$(INSTALL_PREFIX)/lib/focalize

echo -e $BOLDTAG"Where to install FoCaL binaries ?"$NORMALTAG
echo -e "Default is $INSTALL_BIN."
echo -e "Just press enter to use default location."
read USER_INPUT
if [ "$USER_INPUT" != "" ] ;
   then
   INSTALL_BIN=$USER_INPUT
fi

echo -e $BOLDTAG"Where to install FoCaLize libraries ?"$NORMALTAG
echo -e "Default is $INSTALL_LIB."
echo -e "Just press enter to use default location."
read USER_INPUT
if [ "$USER_INPUT" != "" ] ;
   then
   INSTALL_LIB=$USER_INPUT
fi

# Generate the installation related source file.
echo "(* This file is automatically generated by configure. Do not manually edit. *)" \
     > basement/installation.ml
echo "let install_bin_dir = \"$FOC_INSTALL_BIN\" ;;" >> basement/installation.ml
echo "let install_lib_dir = \"$FOC_INSTALL_LIB\" ;;" >> basement/installation.ml
echo "(* End of generated source file. *)" >> basement/installation.ml

# Generate the installation related Makefile definitions.
echo "#This file is automatically generated by configure. Do not manually edit." \
     > Makefile.install
echo "INSTALL_BIN = $FOC_INSTALL_BIN" >> Makefile.install
echo "INSTALL_LIB = $FOC_INSTALL_LIB" >> Makefile.install

# Building dependancy files
make depend

# Summary feedback.
echo -e "Configuration summary for focalizec:"
echo -e "  binaries -> $INSTALL_BIN"
echo -e "  libraries -> $INSTALL_LIB"

echo "Done. Now, please invoke: make all"
