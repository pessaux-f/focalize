% $Id: doc_gen.tex,v 1.3 2009-01-14 17:38:00 pessaux Exp $
{\color{red} TODO: make clear the vocabulary
  comment/documentation/documentation comment}.

When invoked with the {\tt $-$focalize-doc} option, the command
{\tt focalizec} generates an extra file (with the ``.fcd'' suffix)
containing ``documentation'' information extracted from the compiled
source file.

This information describes the different elements found in the source
file (species, collections, methods, toplevel definitions, type
definitions) with various annotations like type,
definition/inheritance locations. It also contains the comments
previously called ``documentations'' (c.f \ref{documentation}) and that
were kept during the compilation process. Moreover, these comments can
contain special markups used by the documentation generator of \focal.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Special markups}
\focal's documentation system currently supports 5 kinds of
markup. They impact the content of the final generated document,
either in its content or in the way information is displayed depending
on the output format. These markups start with the ``@'' character and
the content of the markup follows and finishes at the end of the
line. It is then possible in a documentation comment to mix regular
text that won't be interpreted and markups.

\subsubsection{@title}
This markup must appear (i.e. is only taken into account) in the first
documentation comment on the source file. The following text is
considered to be the title of the source file and will appear in the
header of the final document.

See example provided for the {\tt @description} markup below.



\subsubsection{@author}
This markup must appear (i.e. is only taken into account) in the first
documentation comment on the source file. The following text is
considered to be the author of the source file and will appear in the
header of the final document.

See example provided for the {\tt @description} markup below.



\subsubsection{@description}
This markup must appear (i.e. is only taken into account) in the first
documentation comment on the source file. The following text is
considered to be the description of the content of the source file
(what services it implements) and will appear in the header of the
final document.

For example:
{\scriptsize
\begin{lstlisting}
(***********************************************************************)
(*                        FoCaL compiler                               *)
(*  Copyright 2007 LIP6 and INRIA                                      *)
(*  Distributed only by permission.                                    *)
(***********************************************************************)

(**
 @title FoC Project. Basic algebra.
 @author The FoC project
 @description Basic sets operations, orderings and lattices.
*)
...
\end{lstlisting}
}
will lead to a document header like (in HTML format):

\medskip
\includegraphics{header_html_snapshot.ps}

You may notice in the above source code example that the header
information is located in a documentation comment that does not look
to the {\bf first} one. In effect, the top-most banner starting by
{\scriptsize
\begin{lstlisting}
(***********************************************************************)
\end{lstlisting}
}
is in fact also a documentation comment since it starts by the
sequence ``(**''. In fact, a ``documentation'' is a sequence of
documentation comments. Hence several consecutive documentation
comments form a ``documentation''. For this reason, our header
information, even if located in the third documentation comment is
located in the first documentation.


\subsubsection{@mathml}
This markup must appear in the document comment preceding a method
definition. It indicates the sequence of MathML code to use to replace
the name of the method everywhere in the current document. This markup
only affects the HTML display since it allows to show more usual
symbols rather than identifiers in a browser. This is expecially
useful for mathematical formulaes where one prefer to see the sign $=$
rather than an identifier ``{\tt equal}''.

For example:
{\scriptsize
\begin{lstlisting}
(** In a setoid, we can test the equality (note for logicians: this is
   a congruence). *)
species Setoid inherits Basic_object =
  (** @mathml <eq/> *)
  signature equal : Self -> Self -> bool ;
  property equal_transitive : all x y z in Self,
    equal (x, y) -> equal (y, z) -> equal (x, z) ;
  ...
\end{lstlisting}
}
will replace any occurrence of the method {\tt equal} by the
``\verb+<eq/>+'' MathML sequence that displays a $=$ sign when
displayed by an HTML browser.

\medskip
\includegraphics{mathml_snapshot.ps}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Transforming the generated documentation file}
The generated documentation file is a plain ASCII text containing some
XML compliant with \focal's DTD
({\tt focalize/focalizec/src/docgen/focdoc.dtd}). Like for any XML
files processing is performed thank to the command \xsltproc\ with 
XSL stylesheets (``.xsl'' files).

You may write custom XSL stylesheets to process this XML but the
distribution already provides 2 stylesheets to format this
information.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{XML to HTML}
Transformation from ``.fcd'' to a format that can be read by a WEB
browser is performed in two passes.
\begin{enumerate}
  \item Convert the ``.fcl'' file to HTML with MathML annotations.
  This is done applying the stylesheet
  {\tt focalize/focalizec/src/docgen/focdoc2html.xsl} with the command
  \xsltproc.

  For example:
  {\scriptsize
  \begin{verbatim}
  xsltproc ''directory to the stylesheet''/focdoc2html.xsl mysrc.fcd > tmp
  \end{verbatim}
  }

  \item Convert the HTML+MathML temporary file into HTML.
  This is done applying the stylesheet
  {\tt focalize/focalizec/src/docgen/focdoc2html.xsl} with the command
  \xsltproc.

  For example:
  {\scriptsize
  \begin{verbatim}
  xsltproc ''directory to the stylesheet''/mmlctop2_0.xsl mysrc.fcd > mysrc.xml
  \end{verbatim}
  }
  You may note that the final result file name must be ended by the
  suffix ``.xml'' otherwise your browser won't be able to interpret it
  correctly and won't display symbols ($\Rightarrow, \in, \exists,
  \rightarrow, \ldots$) correctly.
\end{enumerate}

\subsection{XML to LaTeX}
