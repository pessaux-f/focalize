#!/bin/sh

#**********************************************************************#
#                                                                      #
#                        FoCaLize compiler                             #
#                                                                      #
#            François Pessaux                                          #
#            Pierre Weis                                               #
#            Damien Doligez                                            #
#                                                                      #
#                               LIP6  --  INRIA Rocquencourt           #
#                                                                      #
#  Copyright 2008 INRIA                                                #
#  Distributed only by permission.                                     #
#                                                                      #
#**********************************************************************#

#  $Id: .configure,v 1.12 2009-05-22 13:37:59 weis Exp $

# The file .config_var has been built by configure. We load it.
. ./.config_var_for_shell

SUB_DIRS="src/basement src/parser src/typing \
  src/docgen src/commoncodegen src/mlcodegen src/coqcodegen \
  src/toplevel src/focalizedep \
  doc_src doc_src/tex doc_src/html doc_src/man \
  doc_src/tex/refman \
  src/stdlib \
  src/extlib src/extlib/algebra src/extlib/access_control \
  src/contribs \
  src/contribs/automata src/contribs/utils src/contribs/voter \
"

# Touching .depend files to oblige make to redo dependencies
touch .depend

for i in $SUB_DIRS ; do
  (\cd $i; touch .depend; mkdir -p odoc)
done

# Generate the installation related source file.
INSTALL_ML=src/basement/installation.ml
rm -rf $INSTALL_ML
echo "(* This file is automatically generated by configure. Do not manually edit. *)" \
     > $INSTALL_ML
echo "let install_bin_dir = \"$BIN_DIR\" ;;" >> $INSTALL_ML
echo "let install_lib_dir = \"$LIB_DIR/$PROJECT_NAME_FULL\" ;;" >> $INSTALL_ML
echo "let caml_byt_compiler = \"$CAML_BYT_COMPILER\" ;;" >> $INSTALL_ML
echo "let caml_bin_compiler = \"$CAML_BIN_COMPILER\" ;;" >> $INSTALL_ML
echo "let coq_compiler = \"$COQ_COMPILER\" ;;" >> $INSTALL_ML
echo "let zvtov_compiler = \"$ZVTOV_COMPILER\" ;;" >> $INSTALL_ML
echo "let zenon_compiler = \"$ZENON_COMPILER\" ;;" >> $INSTALL_ML
echo "let zenon_libdir = \"$ZENON_LIB_DIR\" ;;" >> $INSTALL_ML
echo "(* End of generated source file. *)" >> $INSTALL_ML
chmod a-w $INSTALL_ML

# Building dependancy files
make depend
