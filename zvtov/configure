#!/bin/sh

#**********************************************************************#
#                                                                      #
#                        FoCaLize compiler                             #
#                                                                      #
#            François Pessaux                                          #
#            Pierre Weis                                               #
#            Damien Doligez                                            #
#                                                                      #
#                               LIP6  --  INRIA Rocquencourt           #
#                                                                      #
#  Copyright 2008 INRIA                                                #
#  Distributed only by permission.                                     #
#                                                                      #
#**********************************************************************#

#  $Id: configure,v 1.17 2008-12-07 23:50:46 weis Exp $

# Default settings
PREFIX=/usr/local

USE_XMLRPC=false
XMLRPC=xmlrpc
XMLRPC_FLAGS="`ocamlfind query -r -i-format xmlrpc | tr '\012' ' '`"
XMLRPC_LINK="`ocamlfind query -r -predicates byte -a-format xmlrpc | tr '\012' ' '`"

set_dirs () {
  BIN_DIR="${PREFIX}/bin"
}

set_dirs

while : ; do
  case $# in 0) break;; esac

  case $1 in
  -prefix | --prefix) PREFIX="$2"; set_dirs; shift 2;;
  -bindir | --bindir) BIN_DIR="$2"; shift 2;;
  -use_xmlrpc | --use_xmlrpc) USE_XMLRPC=true; shift;;
  -xmlrpc | --xmlrpc) XMLRPC="$2"; shift 2;;
  -xmlrpc_flags | --xmlrpc_flags) XMLRPC_FLAGS="$2"; shift 2;;
  -xmlrpc_link | --xmlrpc_link) XMLRPC_LINK="$2"; shift 2;;
  -help | --help)
     echo "usage: ./configure [options]"
     echo "options are:"
     echo
     echo "  [-]-prefix <directory>";
     echo "    set the directory prefix for installation (default ${PREFIX})."
     echo "  [-]-bindir <directory>";
     echo "    set the binary directory for installation (default ${BIN_DIR})."
     echo "  [-]-use_xmlrpc";
     echo "    configure zvtov to use xmlrpc."
     echo "  [-]-xmlrpc <executable-file>";
     echo "    set absolute path for the command xmlrpc."
     echo "  [-]-xmlrpc_flags <string>";
     echo "    set the string option argument to pass to xmlrpc invocations."
     echo "  (Default value for <string> is:";
     echo "   \"`ocamlfind query -r -i-format xmlrpc | tr '\012' ' '`\").";
     echo "  [-]-xmlrpc_link <string>";
     echo "    set the link options to pass when linking xmlrpc.";
     echo "  (Default value for <string> is:";
     echo "   \"`ocamlfind query -r -predicates byte -a-format xmlrpc | tr '\012' ' '`\").";
     echo "  [-]-help";
     echo "    display help and exit"
     exit 0
     ;;
  *) echo "./configure: bad option '$1'" >&2
     echo "For help, use ./configure -help" >&2
     exit 2
     ;;
  esac
  shift
done

if $USE_XMLRPC; then
  XMLRPC=xmlrpc
  XMLRPC_FLAGS="`ocamlfind query -r -i-format xmlrpc | tr '\012' ' '`"
  XMLRPC_LINK="`ocamlfind query -r -predicates byte -a-format xmlrpc | tr '\012' ' '`"
else
  XMLRPC=
  XMLRPC_FLAGS=
  XMLRPC_LINK=
fi

sed -e "s,@PREFIX@,$PREFIX," \
    -e "s,@BIN_DIR@,$BIN_DIR," \
\
    -e "s,@USE_XMLRPC@,$USE_XMLRPC," \
    -e "s,@XMLRPC@,$XMLRPC," \
    -e "s,@XMLRPC_FLAGS@,$XMLRPC_FLAGS," \
    -e "s,@XMLRPC_LINK@,$XMLRPC_LINK," \
    <.config_var.in >.config_var

echo "Configuration summary for zvtov:"
cat .config_var
